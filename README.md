# NaifeiTV Telegram Bot

## 项目简介

NaifeiTV Telegram Bot 是一个专为影视爱好者打造的 Telegram 机器人，支持在 Telegram 聊天窗口内一键搜索、浏览、播放奈飞TV影视资源。机器人界面美观，交互友好，支持群组与用户统计，适合个人和群组使用。

---

## 项目亮点
- **一键搜索**：输入关键词即可获取影片信息、简介、评分、类型、缩略图。
- **美观展示**：支持 emoji、Markdown 加粗、分层信息、按钮分组，界面清晰美观。
- **详情与片源切换**：支持影片详情、集数展示、片源切换、点击播放。
- **群组统计**：统计机器人加入的所有群组、人数、邀请链接。
- **用户统计**：统计每个用户的搜索次数、片名，支持按天数查询。
- **数据安全**：所有数据本地存储，用户隐私有保障。
- **易用部署**：只需填写 Token 即可运行，无需环境变量配置。

---

## 依赖环境
- Python 3.8 及以上
- 依赖包：
  - requests
  - beautifulsoup4
  - python-telegram-bot==20.0

安装依赖：
```bash
pip install -r requirements.txt
```

---

## Token 配置

1. 打开 `bot/telegram_bot.py` 文件。
2. 找到如下位置：
   ```python
   BOT_TOKEN = 'YOUR_BOT_TOKEN_HERE'  # 这里填你的机器人Token
   ```
3. 将 `'YOUR_BOT_TOKEN_HERE'` 替换为你自己的 Telegram 机器人 Token。

---

## 启动机器人

```bash
python main.py
```

---

## 主要命令与效果说明

| 命令   | 说明                         |
|--------|------------------------------|
| /st    | 启动欢迎，显示帮助信息       |
| /so 关键词 | 搜索影片（简要结果，前5条）|
| /se 关键词 | 搜索影片（带详情按钮）     |
| /gr    | 查看机器人已加入的群组统计   |
| /us [天数] | 查询用户搜索统计（默认10天）|

### 详细命令与效果

- `/st`
  - 显示欢迎信息和基本用法。
  - 效果示例：
    ```
    欢迎使用奈飞TV搜索机器人！
    使用 /so 关键词 搜索影片。
    ```

- `/so 关键词`
  - 快速搜索影片，返回前5个结果（名称+简介，带emoji和加粗）。
  - 效果示例：
    ```
    🎬 *焚城*
    📝 危险物质突发泄漏！24小时后危及香港全城……
    ---
    🎬 *误杀3*
    📝 郑炳睿的宝贝女儿婷婷众目睽睽之下遭神秘绑匪绑架……
    ---
    ```

- `/se 关键词`
  - 搜索影片，返回带详情按钮的结果（名称、简介、评分、类型、缩略图，按钮分组）。
  - 点击"🔎 详情"按钮可查看集数、片源切换、播放链接。
  - 效果示例：
    - 机器人发送：
      > ![缩略图]
      > 🎬 *焚城*
      > ⭐ 评分: 9.0
      > 📝 简介: 危险物质突发泄漏！24小时后危及香港全城……
      > 🏷️ 类型: 剧情
      > [🔎 详情]
    - 点击详情后：
      > 🎬 *焚城*
      > 📝 简介: 危险物质突发泄漏！24小时后危及香港全城……
      > 📺 集数: 48
      > 第1集: ...
      > ...
      > [片源1] [片源2]
    - 点击片源后：
      > ▶️ [点击这里播放](https://www.naifeitv.me/play/xxxx-1.html)

- `/gr`
  - 查看机器人已加入的所有群组，显示群组名称、人数、邀请链接。
  - 效果示例：
    ```
    群组: 影视交流群
    人数: 123
    邀请链接: https://t.me/joinchat/xxxx
    ---
    ```

- `/us [天数]`
  - 查询所有用户在指定天数内的搜索统计（默认10天）。
  - 效果示例：
    ```
    10天内用户搜索统计：
    用户: Alice
    搜索次数: 5
    片名: 焚城, 误杀3, ...
    ---
    用户: Bob
    搜索次数: 2
    片名: 恶行之外, 棋士
    ---
    ```

---

## 机器人界面美观展示说明
- **emoji点缀**：让信息更直观易读。
- **Markdown加粗**：影片名、重要信息突出显示。
- **按钮分组**：详情、片源切换、播放等按钮分组展示，操作更清晰。
- **图片+文字**：每部影片配缩略图，信息一目了然。
- **消息编辑**：详情、片源切换等操作时，直接编辑原消息，减少刷屏。

---

## 数据库文件说明
- 所有数据保存在 `bot/botdata.db`，为 SQLite 格式。
- 用户搜索数据只保留最近30天，自动循环清理。
- 群组信息永久保存。
- 建议定期备份 `bot/botdata.db` 文件以防数据丢失。

---

## 常见问题 FAQ

**Q: 机器人Token怎么获取？**
A: 在 Telegram 搜索 @BotFather，创建新Bot后会获得Token。

**Q: 机器人为什么无法获取群组邀请链接？**
A: 需将机器人设置为群组管理员。

**Q: 影片无法播放？**
A: 片源为网页地址，部分资源可能需科学上网。

**Q: 数据库会无限增大吗？**
A: 不会，用户搜索数据只保留30天，旧数据自动清理。

**Q: 如何修改命令或界面？**
A: 编辑 `bot/telegram_bot.py` 文件即可自定义命令和展示方式。

---

## 新手操作流程
1. 安装 Python 3.8+，并安装依赖。
2. 获取 Telegram Bot Token，填入 `bot/telegram_bot.py`。
3. 运行 `python main.py` 启动机器人。
4. 在 Telegram 搜索你的机器人，或将其拉入群组。
5. 按照 `/st`、`/so`、`/se` 等命令体验功能。

---

## 目录结构

```
naifeitv-telegram-bot/
├── requirements.txt
├── main.py
├── README.md
├── naifeitv_spider/
│   ├── __init__.py
│   └── spider.py
└── bot/
    ├── __init__.py
    ├── telegram_bot.py
    └── db.py
```

---

## 联系与致谢

如有问题或建议，请在项目 issue 区留言，或联系开发者。

感谢所有开源社区和用户的支持！ 